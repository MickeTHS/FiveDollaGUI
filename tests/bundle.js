!function(t){function e(n){if(o[n])return o[n].exports;var r=o[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var o={};e.m=t,e.c=o,e.d=function(t,o,n){e.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=2)}([function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});!function(t){t[t.ANCHOR_TOPLEFT=1]="ANCHOR_TOPLEFT",t[t.ANCHOR_CENTER=2]="ANCHOR_CENTER"}(e.Anchor||(e.Anchor={}));!function(t){t[t.BACKGROUND_IMAGE_STRETCH=1]="BACKGROUND_IMAGE_STRETCH",t[t.BACKGROUND_IMAGE_REPEAT=2]="BACKGROUND_IMAGE_REPEAT",t[t.BACKGROUND_IMAGE_CENTER=3]="BACKGROUND_IMAGE_CENTER"}(e.BackgroundImage||(e.BackgroundImage={}));!function(t){t[t.MOUSEBUTTON_LEFT=0]="MOUSEBUTTON_LEFT",t[t.MOUSEBUTTON_MIDDLE=1]="MOUSEBUTTON_MIDDLE",t[t.MOUSEBUTTON_RIGHT=2]="MOUSEBUTTON_RIGHT"}(e.MouseButton||(e.MouseButton={}));!function(t){t[t.STATE_NO_CHANGE=0]="STATE_NO_CHANGE",t[t.STATE_CHANGE_TO_FRONT=1]="STATE_CHANGE_TO_FRONT",t[t.STATE_CHANGE_TO_BACK=2]="STATE_CHANGE_TO_BACK",t[t.STATE_ICON_ADDED=3]="STATE_ICON_ADDED",t[t.STATE_COLOR_CHANGE=4]="STATE_COLOR_CHANGE"}(e.State||(e.State={}));!function(t){t[t.ICON_STYLE_NORMAL=1]="ICON_STYLE_NORMAL",t[t.ICON_STYLE_STRETCHED=2]="ICON_STYLE_STRETCHED"}(e.IconStyle||(e.IconStyle={}));!function(t){t[t.NODE_NOT_INSIDE=0]="NODE_NOT_INSIDE",t[t.NODE_PARTIALLY_INSIDE=1]="NODE_PARTIALLY_INSIDE",t[t.NODE_FULLY_INSIDE=2]="NODE_FULLY_INSIDE"}(e.NodeOverlaps||(e.NodeOverlaps={}));!function(t){t[t.RT_SQUARE=0]="RT_SQUARE",t[t.RT_POLYGON=1]="RT_POLYGON",t[t.RT_BORDER_SQUARE=2]="RT_BORDER_SQUARE",t[t.RT_BORDER_POLY=3]="RT_BORDER_POLY",t[t.RT_TEXT=4]="RT_TEXT",t[t.RT_ICON=5]="RT_ICON"}(e.RenderType||(e.RenderType={}))},function(t,e,o){"use strict";function n(t){return t*Math.PI/180}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){return function(){}}();e.Point=r;var i=function(){return function(){}}();e.Rect=i;var _=function(){function t(){}return t.invert_points=function(t){for(var e=[],o=t.length-1;o>=0;--o)e.push(t[o]);for(o=0;o<e.length;++o)t[o]=e[o]},t.line_intersection=function(t,e,o,n,r,i,_,s,h){var c,a,d,p,u;return!(t==o&&e==n||r==_&&i==s)&&(o-=t,n-=e,r-=t,i-=e,_-=t,s-=e,c=Math.sqrt(o*o+n*n),a=o/c,d=n/c,p=r*a+i*d,i=i*a-r*d,r=p,p=_*a+s*d,s=s*a-_*d,_=p,i!=s&&(u=_+(r-_)*s/(s-i),h.x=t+u*a,h.y=e+u*d,!0))},t.inset_corner=function(e,o,n,r,i,_,s,h){var c,a,d,p,u,l,f,y,g=n,v=r,x=n,m=r;if(c=n-e,a=r-o,d=Math.sqrt(c*c+a*a),p=i-n,u=_-r,l=Math.sqrt(p*p+u*u),0!=d&&0!=l){if(f=a/d*h,e+=f,g+=f,y=-c/d*h,o+=y,v+=y,f=u/l*h,i+=f,x+=f,y=-p/l*h,_+=y,m+=y,g==x&&v==m)return s.x=g,void(s.y=v);var w={x:0,y:0};t.line_intersection(e,o,g,v,x,m,i,_,w)&&(s.x=w.x,s.y=w.y)}},t.inset_polygon=function(e,o){var n,r,i,_,s,h,c,a=e[0].x,d=e[0].y,p=e.length;if(p<3)return!1;for(i=e[p-1].x,_=e[p-1].y,s=e[0].x,h=e[0].y,c=0;c<p-1;c++)n=i,r=_,i=s,_=h,s=e[c+1].x,h=e[c+1].y,t.inset_corner(n,r,i,_,s,h,e[c],o);return t.inset_corner(i,_,s,h,a,d,e[c],o),!0},t.find_angle=function(t,e,o){var n=Math.sqrt(Math.pow(o.x-t.x,2)+Math.pow(o.y-t.y,2)),r=Math.sqrt(Math.pow(o.x-e.x,2)+Math.pow(o.y-e.y,2)),i=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));return Math.acos((r*r+n*n-i*i)/(2*r*n))},t.shrink_corner=function(e,o,r,i){var _=t.find_angle(e,o,r)/2,s=0,h=0;return e.x<=r.x&&o.x>=r.x&&e.y>=r.y&&o.y>=r.y&&(console.log("case 1"),s=e.x-r.x>o.x-r.x?i*Math.sin(_-n(90)):i*Math.sin(_-n(90))*-1,h=i*Math.cos(_)*-1,console.log("x: "+s+", y: "+h)),e.x>=o.x&&e.y>=o.y?(s=i*Math.cos(_),h=i*Math.sin(_)*-1):e.x<=o.x&&e.y<=o.y?(s=i*Math.sin(_)*-1,h=i*Math.cos(_)):e.x<=o.x&&e.y>=o.y?(s=i*Math.cos(_),h=i*Math.sin(_)):e.x>=o.x&&e.y<=o.y?(s=i*Math.sin(_)*-1,h=i*Math.cos(_)*-1):console.log("ERROR IN SHRINK CORNER"),{x:r.x+s,y:r.y+h}},t.p_poly=function(t,e,o){var n,r,i=t.length,_=!1;for(n=0,r=i-1;n<i;r=n++)t[n].y>o!=t[r].y>o&&e<(t[r].x-t[n].x)*(o-t[n].y)/(t[r].y-t[n].y)+t[n].x&&(_=!_);return _},t.a_rect_contains_b=function(t,e){return e.x+e.w<t.x+t.w&&e.x>t.x&&e.y<t.y&&e.y+e.h<t.y+t.h},t.a_rect_overlaps_b=function(t,e){return t.x<e.x+e.w&&t.x+t.w>e.x&&t.y<e.y+e.h&&t.h+t.y>e.y},t.random_hex_color=function(){return"#000000".replace(/0/g,function(){return(~~(16*Math.random())).toString(16)})},t.rect_center_to_topleft=function(t){return{x:t.x-t.w/2,y:t.y-t.h/2,w:t.w,h:t.h}},t.rect_topleft_to_center=function(t){return{x:t.x+t.w/2,y:t.y+t.h/2,w:t.w,h:t.h}},t.min_arr=function(t,e){for(var o=Number.POSITIVE_INFINITY,n=0;n<t.length;++n)t[n][e]<o&&(o=t[n][e]);return o},t.max_arr=function(t,e){for(var o=Number.NEGATIVE_INFINITY,n=0;n<t.length;++n)t[n][e]>o&&(o=t[n][e]);return o},t.calc_br=function(e){var o=t.min_arr(e,"x"),n=t.max_arr(e,"x"),r=t.min_arr(e,"y");return{x:o,y:r,w:n-o,h:t.max_arr(e,"y")-r}},t.point_in_rect=function(t,e,o){return!(o.x>t||o.x+o.w<t||o.y>e||o.y+o.h<e)},t.sign=function(t,e,o,n,r,i){return(t-r)*(n-i)-(o-r)*(e-i)},t.point_in_triangle=function(e,o,n,r,i,_,s,h){var c=t.sign(e,o,n,r,i,_)<0,a=t.sign(e,o,i,_,s,h)<0,d=t.sign(e,o,s,h,n,r)<0;return c==a&&a==d},t}();e.FDGMath=_},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o(3);console.log("starting app");var r=new n.GUI("main");r.on("node_selected",function(t){}),r.on("node_highlight",function(t){}),r.on("mousedown",function(t,e,o){}),r.on("mouseup",function(t,e,o){}),r.on("mousemove",function(t,e,o){})},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o(1),r=o(0),i=o(0),_=o(0),s=o(0),h=o(0),c=o(4),a=o(5),d=o(6),p=o(7),u=o(8),l=o(0),f=0,y=0,g=[],v=function(){for(var t=0;t<g.length;++t){g[t].draw("default",!0)}window.requestAnimationFrame(v)};v();var x=function(){function t(t,e,o){void 0===e&&(e=r.Anchor.ANCHOR_CENTER),void 0===o&&(o=2),console.log("GUI Constructor for "+t),g.push(this),this._select_boxing={running:!1,rect:null},this._draw_history=[],this._anchor_point=e,this._canvas_elem=document.getElementById(t),this._width=this._canvas_elem.offsetWidth,this._height=this._canvas_elem.offsetHeight;var n=this._canvas_elem;this._renderer=new c.Render_screen(t,this._width,this._height),this._renderer.set_font(12,"Verdana"),this._zoom_enabled=!1,this._pan_enabled=!1,this._select_box_enabled=!1,this._events={},this._events.click=[],this._events.node_selected=[],this._events.node_highlight=[],this._events.node_deselected=[],this._events.mousemove=[],this._events.mousedown=[],this._events.mouseup=[];var i=this;n.addEventListener("mousedown",function(t){i.on_mouse_down(t)},!1),n.addEventListener("mouseup",function(t){i.on_mouse_up(t)},!1),n.addEventListener("mousemove",function(t){i.on_mouse_move(t)},!1),n.addEventListener("mouseover",function(t){i.on_mouse_over(t)},!1),this._draw_counter=0,this._canvas_elem.addEventListener("mousewheel",function(t){var e=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail));this.wheel(e)}.bind(this),!1),this._dragging=!1,this._drag_node=null,this._high_node=null,this._nodes=[],this._lines={},this._layer="default",this._locked=!1,this._mouse_inside=!1,this._zoom_factor=1,this._center={x:this._width/2,y:this._height/2},this._quads={},this._quad_division=o,this._selected_nodes={},this._prev_center={x:0,y:0},this._force_draw=!1,this._bg_image=null,this._bg_sizing=0,this._rect={x:0,y:0,w:this._width,h:this._height};var _=this._canvas_elem.getBoundingClientRect();this._pos_rect={x:_.left,y:_.top,w:this._width,h:this._height},this._render_types=new u.Render_type_handler(this._renderer),this.generate_quads(o),this.add_layer(this._layer)}return t.prototype.on_mouse_over=function(t){this._mouse_inside=!0},t.prototype.on_mouse_out=function(t){console.log("MOUSE OUT");var e=t.clientX,o=t.clientY;this._mouse_inside=!1;var n=this._canvas_elem.getBoundingClientRect(),r=n.left,i=n.top;n.width,n.height;this.mouseout(e-r,o-i)},t.prototype.on_mouse_move=function(t){console.log("mouse moved");var e=this._canvas_elem.getBoundingClientRect(),o=t.clientX-e.left,n=t.clientY-e.top;this.mousemove(o,n)},t.prototype.on_mouse_down=function(t){var e=this._canvas_elem.getBoundingClientRect(),o=t.clientX-e.left,n=t.clientY-e.top;console.log("MOUSE DOWN: "+o+" y: "+n),this.mousedown(o,n,t.button)},t.prototype.on_mouse_up=function(t){console.log("MOUSE UP");var e=this._canvas_elem.getBoundingClientRect(),o=t.clientX-e.left,n=t.clientY-e.top;this.mouseup(o,n,t.button)},t.prototype.on_mouse_wheel=function(t,e){if(e==this._canvas_elem){var o=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail));this.wheel(o)}},t.prototype.num_drawcalls=function(){for(var t=0,e=0;e<this._draw_history.length;++e)t+=this._draw_history[e];return t/this._draw_history.length},t.prototype.init=function(){},t.prototype.set_static_background_image=function(t,e){var o=new Image,n=this,r=document.getElementById("bg").getContext("2d");o.src=t,o.addEventListener("load",function(){var t=o.width*e,i=o.height*e,_=n._width,s=n._height;t>_&&console.error("image wont fit, stretching"),i>s&&console.error("image wont fit, stretching");var h=_-t,c=s-i;r.drawImage(o,0,0,o.width,o.height,h/2,c/2,_-h,s-c),n=null,o=null})},t.prototype.load_atlas=function(t,e,o){var n=new Image;n.addEventListener("load",function(){n.width,n.height;var t=new p.GUI_atlas(n,"");o(t),o=null,t=null,null}),n.src=t},t.prototype.get_quad=function(t){return this._quads[t]},t.prototype.set_bg_image_obj=function(t){this._bg_image=t},t.prototype.set_bg_image=function(t,e){void 0===e&&(e=i.BackgroundImage.BACKGROUND_IMAGE_STRETCH);var o=new Image,n=this;this._bg_sizing=e,o.addEventListener("load",function(){n.set_bg_image_obj(o);var t=n._bg_image.width,e=n._bg_image.height;if(n._bg_sizing==i.BackgroundImage.BACKGROUND_IMAGE_STRETCH)for(var r=t/n._quad_division,_=e/n._quad_division,s=0;s<n._quad_division;++s)for(var h=0;h<n._quad_division;++h){var c={x:r*h,y:_*s,w:r,h:_};n._quads[h+":"+s].set_bg_image(o,c)}n=null,o=null}),o.src=t},t.prototype.on=function(t,e){this._events[t].push(e)},t.prototype.canvas=function(){return this._canvas_elem},t.prototype.generate_quads=function(t){this._quad_division=t;for(var e=this._width/t,o=this._height/t,n=0;n<t;++n)for(var r=0;r<t;++r){var i=r+":"+n;this._quads[i]=new d.GUI_quad(this._renderer,{x:r*e,y:n*o,w:e,h:o},i),this._quads[i].set_bg_color("#000")}},t.prototype.calc_quads_for_node=function(t){var e={};for(var o in this._quads){var n=this._quads[o].calc_node_inside(t);if(n==h.NodeOverlaps.NODE_FULLY_INSIDE)return e[o]=this._quads[o],e;n==h.NodeOverlaps.NODE_PARTIALLY_INSIDE&&(e[o]=this._quads[o])}return e},t.prototype.create_stored_box=function(t,e,o,n,r,i,_,s,h){void 0===i&&(i=""),void 0===_&&(_="#000"),void 0===s&&(s=1),void 0===h&&(h="#fff");for(var c=0;c<this._nodes.length;++c)if(this._nodes[c].id()==t)return this._nodes[c];var d=new a.GUI_node(this._renderer,t,this._anchor_point,"square");y=t+1,d.set_pos(e,o),d.set_width(n),d.set_height(r),d.set_background_color(_),d.set_border_color("#000"),d.set_caption(i),d.set_border_thickness(s),d.recalculate(),d.set_prev_state(e,o,n,r),this._nodes.push(d);this._render_types.add_square(_).add_node(d);this._render_types.add_border(s,"#000").add_node(d);var p=this.calc_quads_for_node(d);for(var u in p)p[u].add_node(d);return d.set_quad_ids(Object.keys(p)),d},t.prototype.create_box=function(t,e,o,n,r,i,_,s){void 0===r&&(r=""),void 0===i&&(i="#000"),void 0===_&&(_=1),void 0===s&&(s="#fff");var h=new a.GUI_node(this._renderer,y++,this._anchor_point,"square");h.set_pos(t,e),h.set_width(o),h.set_height(n),h.set_background_color(i),h.set_border_color("#000"),h.set_caption(r),h.set_border_thickness(_),h.recalculate(),h.set_prev_state(t,e,o,n),this._nodes.push(h);this._render_types.add_square(i).add_node(h);if(this._render_types.add_border(_,"#000").add_node(h),""!=r){this._render_types.add_text("#ffffff").add_node(h)}var c=this.calc_quads_for_node(h);for(var d in c)c[d].add_node(h);return Object.keys(c).length<=0&&console.error("No quads for node!"),h.set_quad_ids(Object.keys(c)),h},t.prototype.get_current_id=function(){return y},t.prototype.create_stored_polygon=function(t,e,o,r,i,_,s,h){void 0===i&&(i=""),void 0===_&&(_="#000"),void 0===s&&(s=1),void 0===h&&(h="#000000");for(var c=0;c<this._nodes.length;++c)if(this._nodes[c].id()==t)return this._nodes[c];y=t+1;var d=new a.GUI_node(this._renderer,t,this._anchor_point,"polygon"),p=n.FDGMath.min_arr(r,"x"),u=n.FDGMath.max_arr(r,"x"),l=n.FDGMath.min_arr(r,"y"),f=u-p,g=n.FDGMath.max_arr(r,"y")-l;d.set_pos(e,o),d.set_width(f),d.set_height(g),d.set_points(r),d.set_prev_point_state(d.abs_points()),d.set_background_color(_),d.set_border_color(h),d.set_caption(i),d.set_border_thickness(s);this._render_types.add_polygon(_).add_node(d);if(this._render_types.add_border_poly(s,h).add_node(d),""!=i){this._render_types.add_text("#000000").add_node(d)}this._nodes.push(d);var v=this.calc_quads_for_node(d);for(var x in v)v[x].add_node(d);return d.set_quad_ids(Object.keys(v)),d},t.prototype.create_polygon=function(t,e,o,r,i,_,s){void 0===r&&(r=""),void 0===i&&(i="#000"),void 0===_&&(_=1),void 0===s&&(s="#fff");var h=new a.GUI_node(this._renderer,y++,this._anchor_point,"polygon"),c=n.FDGMath.min_arr(o,"x"),d=n.FDGMath.max_arr(o,"x"),p=n.FDGMath.min_arr(o,"y"),u=d-c,l=n.FDGMath.max_arr(o,"y")-p;console.log("p width: "+u+" p height: "+l),h.set_pos(t,e),h.set_width(u),h.set_height(l),h.set_points(o),h.set_prev_point_state(h.abs_points()),h.set_background_color(i),h.set_border_color(s),h.set_caption(r),h.set_border_thickness(_);this._render_types.add_polygon(i).add_node(h);if(this._render_types.add_border_poly(_,s).add_node(h),""!=r){this._render_types.add_text("#ffffff").add_node(h)}this._nodes.push(h);var f=this.calc_quads_for_node(h);for(var g in f)f[g].add_node(h);return h.set_quad_ids(Object.keys(f)),h},t.prototype.create_circle=function(t,e,o,n,r,i,_){void 0===n&&(n=""),void 0===r&&(r="#aaaaaa"),void 0===i&&(i=.5),void 0===_&&(_="#000");var s=new a.GUI_node(this._renderer,y++,this._anchor_point,"circle");s.set_pos(t,e),s.set_radius(o),s.set_background_color(r),s.set_border_color(_),s.set_caption(n),s.set_border_thickness(i);var h=this.calc_quads_for_node(s);for(var c in h)h[c].add_node(s);return s.set_quad_ids(Object.keys(h)),s},t.prototype.get_quad_with_id=function(t){return t in this._quads?this._quads[t]:null},t.prototype.get_node_with_id=function(t){for(var e in this._quads){var o=this._quads[e].get_node_with_id(t);if(null!=o)return o}return null},t.prototype.update_node_quads=function(t){var e=this.calc_quads_for_node(t);for(var o in e)e[o].add_node(t);t.set_quad_ids(Object.keys(e))},t.prototype.set_zoom=function(t,e,o){this._zoom_factor=o,this._center={x:t,y:e},console.log("zoomed, pos: "+t+", "+e+" factor: "+this._zoom_factor);for(var n in this._quads)this._quads[n].clear_nodes();for(var r=0;r<this._nodes.length;++r){var i=this._nodes[r];if(null!=i)try{if("polygon"==i.shape()){for(var _=i.points(),s=i.prev_point_state(),h=0;h<_.length;++h)_[h].x=Math.round(s[h].x*o),_[h].y=Math.round(s[h].y*o);i.set_points(_)}else{i.pos();var c=i.prev_state();i.set_width(Math.round(c.w*o)),i.set_height(Math.round(c.h*o)),i.set_pos(Math.round(c.x*o-t),Math.round(c.y*o-e))}this.update_node_quads(i)}catch(t){console.log("exception: "+i.id()+":"+t)}else console.log("null node, how?")}for(var n in this._quads)this._quads[n].set_changed(!0);this._prev_center=this._center,this._force_draw=!0},t.prototype.set_center=function(t,e){this._center={x:t,y:e};for(var o=this._center.x-this._prev_center.x,n=this._center.y-this._prev_center.y,r=0;r<this._nodes.length;++r){var i=this._nodes[r],_=i.pos();i.set_pos(Math.round(_.x+o),Math.round(_.y+n),!0)}return this._prev_center=this._center,this._force_draw=!0,this._center},t.prototype.is_mouse_inside=function(){return this._mouse_inside},t.prototype.add_layer=function(t){},t.prototype.set_layer=function(t){this._layer=t},t.prototype.layer=function(){return this._layer},t.prototype.locked=function(){return this._locked},t.prototype.lock=function(){this._locked=!0},t.prototype.unlock=function(){this._locked=!1},t.prototype.add_icon=function(t,e){},t.prototype.icon=function(t){return this._renderer.icon(t)},t.prototype.nodes=function(){return this._nodes},t.prototype.renderer=function(){return this._renderer},t.prototype.connect=function(t,e){},t.prototype.toggle_shadow=function(t){this._renderer.toggle_shadow(t)},t.prototype.shadow=function(){return this._renderer.shadow()},t.prototype.size=function(){return[this._width,this._height]},t.prototype.width=function(){return this._width},t.prototype.height=function(){return this._height},t.prototype.resize=function(t,e){this._width=t,this._height=e,this._renderer.resize(this._width,this._height)},t.prototype.get_quad_at_pos=function(t,e){var o=Math.round(this._width/this._quad_division),n=Math.round(this._height/this._quad_division),r=Math.floor(t/o),i=Math.floor(e/n);return this._quads[r+":"+i]},t.prototype.get_nodes_at_pos=function(t,e){var o=this.get_quad_at_pos(t,e);if(null==o)return null;return o.get_nodes_at_pos(t,e)},t.prototype.mark_changed_node=function(t){for(var e=t.quad_ids(),o=0;o<e.length;++o)this._quads[e[o]].set_changed(!0)},t.prototype.remove_node=function(t){console.log("removing from all"),this._render_types.remove_node_from_all(t);for(var e=0;e<this._nodes.length;++e)this._nodes[e]==t&&this._nodes.splice(e,1)},t.prototype.select_nodes_at_pos=function(t,e){var o=this.get_nodes_at_pos(t,e);for(var n in this._selected_nodes){var r=this._selected_nodes[n];if(r.highlightable()){r.set_selected(!1),this.mark_changed_node(r);var i=null;"square"==r.shape()?(this._render_types.remove_node(r,l.RenderType.RT_SQUARE),i=this._render_types.add_square(r.shaded_color())):"polygon"==r.shape()&&(this._render_types.remove_node(r,l.RenderType.RT_POLYGON),i=this._render_types.add_polygon(r.shaded_color())),i.add_node(r)}}this._selected_nodes={};for(var n in o)if(o[n].highlightable()){this._selected_nodes[n]=o[n],o[n].set_selected(!0);i=null;"square"==o[n].shape()?(this._render_types.remove_node(o[n],l.RenderType.RT_SQUARE),i=this._render_types.add_square(o[n].shaded_color())):"polygon"==o[n].shape()&&(this._render_types.remove_node(o[n],l.RenderType.RT_POLYGON),i=this._render_types.add_polygon(o[n].shaded_color())),i.add_node(o[n]),o[n].set_mousepos(t,e)}},t.prototype.state_change_node=function(t){var e=null;"square"==t.shape()?(this._render_types.remove_node(t,l.RenderType.RT_SQUARE),e=this._render_types.add_square(t.shaded_color())):"polygon"==t.shape()&&(this._render_types.remove_node(t,l.RenderType.RT_POLYGON),e=this._render_types.add_polygon(t.shaded_color())),e.add_node(t),t.pop_state()},t.prototype.wheel=function(t){this._zoom_enabled&&(t<0?this.set_zoom(0,0,1):t>0&&this.set_zoom(this.width(),this.height(),4))},t.prototype.mousedown=function(t,e,o){if(n.FDGMath.point_in_rect(t,e,this._rect)){this._select_box_enabled&&o==_.MouseButton.MOUSEBUTTON_LEFT&&(this._select_boxing.running=!0,this._select_boxing.rect.x=t,this._select_boxing.rect.y=e);for(var r=0;r<this._events.click.length;++r)this._events.click[r](t,e,o,null);for(r=0;r<this._events.mousedown.length;++r)this._events.mousedown[r](t,e,o,null);this.get_quad_at_pos(t,e);if(!this.locked()){null!=this._high_node&&(this._high_node.set_highlighted(!1),this.mark_changed_node(this._high_node));var i=this.get_nodes_at_pos(t,e);if(0!=Object.keys(i).length){if(this._dragging=!0,this._drag_node=i[Object.keys(i)[0]],null!=this._drag_node){this._drag_node.set_selected(!0),this.mark_changed_node(this._drag_node);var s=null;"square"==this._drag_node.shape()?(this._render_types.remove_node(this._drag_node,l.RenderType.RT_SQUARE),s=this._render_types.add_square("#33ff33")):"polygon"==this._drag_node.shape()&&(this._render_types.remove_node(this._drag_node,l.RenderType.RT_POLYGON),s=this._render_types.add_polygon("#33ff33")),s.add_node(this._drag_node);for(r=0;r<this._events.node_selected.length;++r)this._events.node_selected[r](t,e,o,this._drag_node)}if(this._high_node=i[Object.keys(i)[0]],null!=this._high_node){this._high_node.set_highlighted(!0),this.mark_changed_node(this._high_node);for(r=0;r<this._events.node_highlight.length;++r)this._events.node_highlight[r](t,e,o,this._high_node)}}else console.error("no nodes")}}},t.prototype.mouseup=function(t,e,o){if(console.log("RELEASE: "+o),o==_.MouseButton.MOUSEBUTTON_LEFT){console.log("CLOSING SELECT BOX");this._select_boxing.rect;this._select_boxing.running=!1,close_selection_box()}if(!this.locked()){for(var n=0;n<this._events.mouseup.length;++n)this._events.mouseup[n](t,e,o,null);for(n=0;n<this._nodes.length;++n)this.update_node_quads(this._nodes[n]);this._dragging=!1,this._drag_node=null}},t.prototype.mouseout=function(t,e){console.log("mouseout"),this._select_boxing.running=!1,close_selection_box()},t.prototype.mousemove=function(t,e){if(this._select_boxing.running){var o=this._select_boxing.rect.x+this._pos_rect.x,n=this._select_boxing.rect.y+this._pos_rect.y,r=t+this._pos_rect.x-o,i=e+this._pos_rect.y-n;this._select_boxing.rect.w=r,this._select_boxing.rect.h=i,selection_box(o,n,r,i)}if(!this.locked()){for(var _=0;_<this._events.mousemove.length;++_)this._events.mousemove[_](t,e,-1,null);this._dragging?null!=this._drag_node&&this._drag_node.draggable()&&this._drag_node.set_pos(t,e,!0):this.select_nodes_at_pos(t,e)}},t.prototype.get_shapes=function(t){for(var e=[],o=0;o<this._nodes.length;++o)this._nodes[o].shape()==t&&e.push(this._nodes[o]);return e},t.prototype.draw=function(t,e){if(void 0===t&&(t="default"),void 0===e&&(e=!0),f++>45){console.log("draw call");for(var o=0;o<this._nodes.length;++o){var n=this._nodes[o],r=n.state();if(r!=s.State.STATE_NO_CHANGE)if(r==s.State.STATE_CHANGE_TO_FRONT)this._render_types.push_to_front(n),n.pop_state();else if(r==s.State.STATE_CHANGE_TO_BACK)this._render_types.push_back(n),n.pop_state();else if(r==s.State.STATE_ICON_ADDED){this._render_types.add_icon().add_node(n),n.pop_state()}else this.state_change_node(n)}f=0}this._render_types.draw(),this._renderer.swap_buffer(this._rect)},t.prototype.print=function(){this._render_types.print()},t}();e.GUI=x},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,o,n,r,i){this._text=t,this._font_color=o,this._font_size=n,this._font=e,this._x=r,this._y=i}return t.prototype.x=function(){return this._x},t.prototype.y=function(){return this._y},t.prototype.text=function(){return this._text},t.prototype.color=function(){return this._font_color},t.prototype.size=function(){return this._font_size},t.prototype.font=function(){return this._font},t}(),r=function(){function t(t,e,o){console.log("Constructor for Render_screen"),this._mainscreen=document.getElementById(t),this._mainscreen_ctx=this._mainscreen.getContext("2d"),this._offscreen=document.createElement("canvas"),this._mainscreen.width=e,this._mainscreen.height=o,this._offscreen.width=this._mainscreen.width,this._offscreen.height=this._mainscreen.height,this._offscreen_ctx=this._offscreen.getContext("2d"),this._default_font="Bitstream",console.log("context sizes: "+this._mainscreen.width+" "+this._mainscreen.height),this._text_buffer=[],this._shadow=!1,this._icons=[],this._counter=0,this._track={border_states:[],no_border_states:[]}}return t.prototype.init_img_source=function(t){var e=document.getElementById(t),o=document.createElement("canvas");return o.width=e.width,o.height=e.height,o.getContext("2d").drawImage(e,0,0,e.width,e.height),o},t.prototype.get_pixel_image=function(t,e,o){return t.getContext("2d").getImageData(e,o,1,1).data},t.prototype.contrast=function(t){return parseInt(t.substr(1),16)>8388607.5?"#000000":"#ffffff"},t.prototype.calc_shade_color=function(t,e){var o=parseInt(t.slice(1),16),n=e<0?0:255,r=e<0?-1*e:e,i=o>>16,_=o>>8&255,s=255&o;return"#"+(16777216+65536*(Math.round((n-i)*r)+i)+256*(Math.round((n-_)*r)+_)+(Math.round((n-s)*r)+s)).toString(16).slice(1)},t.prototype.add_icon=function(t){this._icons.push(t)},t.prototype.icon=function(t){for(var e=0;e<this._icons.length;++e)if(this._icons[e].name()==t)return this._icons[e];return null},t.prototype.resize=function(t,e){this._mainscreen.width=t,this._mainscreen.height=e,this._offscreen.width=t,this._offscreen.height=e,this._offscreen_ctx=this._offscreen.getContext("2d")},t.prototype.print=function(){console.log("Offscreen context : "+this._offscreen.width+", "+this._offscreen.height)},t.prototype.toggle_shadow=function(t){this._shadow=t},t.prototype.shadow=function(){return this._shadow},t.prototype.clear=function(t){this._mainscreen_ctx.clearRect(t.x,t.y,t.w,t.h),this._offscreen_ctx.clearRect(t.x,t.y,t.w,t.h)},t.prototype.pre_draw=function(){this._offscreen_ctx.translate(.5,.5)},t.prototype.post_draw=function(){this._offscreen_ctx.translate(-.5,-.5)},t.prototype.swap_buffer=function(t){this._mainscreen_ctx.clearRect(t.x,t.y,t.w,t.h),this._mainscreen_ctx.drawImage(this._offscreen,t.x,t.y,t.w,t.h,t.x,t.y,t.w,t.h),this._offscreen_ctx.clearRect(t.x,t.y,t.w,t.h)},t.prototype.set_font=function(t,e){this._offscreen_ctx.font=t+"px "+e},t.prototype.draw_shadow=function(t){this._shadow&&(t.shadowBlur=10,t.shadowOffsetX=5,t.shadowOffsetY=5,t.shadowColor="#000000")},t.prototype.draw_icon_assoc=function(t,e){var o=this._offscreen_ctx;for(var n in e){var r=e[n],i=r.icon_rect();if(null!=i){var _=r.icon().rect();o.drawImage(r.icon().img(),_.x,_.y,_.w,_.h,i.x,i.y,i.w,i.h)}}},t.prototype.draw_text_assoc=function(t,e){var o=this._offscreen_ctx;for(var n in e){var r=e[n],i=r.text_rect();null!=i&&(o.fillStyle=t,o.fillText(r.caption(),i.x,i.y))}},t.prototype.draw_borders_assoc=function(t,e,o){var n=this._offscreen_ctx,r=null;o.length;n.beginPath(),n.lineWidth=e,n.strokeStyle=t;for(var i in o)r=o[i].topleft_rect(),n.moveTo(r.x,r.y),n.lineTo(r.x+r.w,r.y),n.lineTo(r.x+r.w,r.y+r.h),n.lineTo(r.x,r.y+r.h),n.lineTo(r.x,r.y);n.stroke()},t.prototype.draw_no_border_box_assoc=function(t,e){var o=this._offscreen_ctx,n=null;o.fillStyle=t;for(var r in e)n=e[r].topleft_rect(),o.fillRect(n.x,n.y,n.w,n.h)},t.prototype.draw_no_border_poly_assoc=function(t,e){var o=this._offscreen_ctx;o.beginPath(),o.fillStyle=t;var n=0;for(var r in e){var i=e[r].abs_points();o.moveTo(i[0].x,i[0].y),n=i.length;for(var _=1;_<n;++_)o.lineTo(i[_].x,i[_].y);o.lineTo(i[0].x,i[0].y),o.fill()}},t.prototype.draw_borders_poly_assoc=function(t,e,o){var n=this._offscreen_ctx;n.beginPath(),n.lineWidth=e,n.strokeStyle=t;var r=0;for(var i in o){var _=o[i].abs_points();n.moveTo(_[0].x,_[0].y),r=_.length;for(var s=1;s<r;++s)n.lineTo(_[s].x,_[s].y);n.lineTo(_[0].x,_[0].y)}n.stroke()},t.prototype.draw_borders_array=function(t,e,o){var n=this._offscreen_ctx,r=null,i=o.length;n.beginPath(),n.lineWidth=e,n.strokeStyle=t;for(var _=0;_<i;++_)r=o[_].topleft_rect(),n.moveTo(r.x,r.y),n.lineTo(r.x+r.w,r.y),n.lineTo(r.x+r.w,r.y+r.h),n.lineTo(r.x,r.y+r.h),n.lineTo(r.x,r.y);n.stroke()},t.prototype.draw_no_border_box_array=function(t,e){var o=this._offscreen_ctx,n=null,r=e.length;o.fillStyle=t;for(var i=0;i<r;++i)n=e[i].topleft_rect(),o.fillRect(n.x,n.y,n.w,n.h)},t.prototype.draw_box=function(t,e,o,n,r,i,_){var s=this._offscreen_ctx;s.beginPath(),s.rect(t,e,o,n),s.fillStyle=r,s.fill(),s.lineWidth=_,s.strokeStyle=i,s.stroke()},t.prototype.draw_image_blend_color=function(t,e,o,n,r,i){this._offscreen_ctx.drawImage(i.img(),t,e)},t.prototype.draw_icon=function(t,e,o,n,r){this._offscreen_ctx.drawImage(r.img(),t,e,o,n)},t.prototype.draw_image_ctx=function(t,e,o){this._offscreen_ctx.drawImage(t,e.x,e.y,e.w,e.h,o.x,o.y,o.w,o.h)},t.prototype.draw_text_buffer=function(){for(var t=this._offscreen_ctx,e=0;e<this._text_buffer.length;++e){var o=this._text_buffer[e];t.font=o.size()+"px "+o.font(),t.fillStyle=o.color(),t.fillText(o.text(),o.x(),o.y())}this._text_buffer=[]},t.prototype.draw_text_color=function(t,e,o,r,i,_){var s=new n(_,o,i,r,t,e);this._text_buffer.push(s)},t.prototype.draw_text=function(t,e,o,r){var i=new n(r,this._default_font,"#ffffff",o,t,e);this._text_buffer.push(i)},t.prototype.draw_line=function(t,e,o,n,r,i){var _=this._offscreen_ctx;_.beginPath(),_.moveTo(t,e),_.lineTo(o,n),_.lineWidth=r,_.strokeStyle=i,_.stroke()},t.prototype.draw_circle=function(t,e,o,n,r,i){var _=this._offscreen_ctx;_.beginPath(),_.arc(t,e,o,0,2*Math.PI,!1),_.fillStyle=r,_.fill(),_.lineWidth=n,_.strokeStyle=i,_.stroke()},t.prototype.draw_circle_caption=function(t,e,o,n,r,i,_,s,h){void 0===h&&(h=16);var c=this._offscreen_ctx;this.draw_circle(t,e,o,n,r,i),c.font=h+"px "+s;var a=c.measureText(_).width/2;this.draw_text_color(t-a,e,this._default_font,h,"white",_)},t.prototype.calc_text_width=function(t){return this._offscreen_ctx.measureText(t).width},t.prototype.draw_fill_points=function(t,e,o,n){if(t.length<3)return!1;var r=this._offscreen_ctx;r.beginPath(),r.moveTo(t[0].x,t[0].y);for(var i=1;i<t.length;++i)r.lineTo(t[i].x,t[i].y);return r.lineTo(t[0].x,t[0].y),r.fillStyle=o,r.fill(),r.lineWidth=e,r.strokeStyle=n,r.stroke(),!0},t.prototype.draw_fill_path=function(t,e,o,n,r,i){var _=this._offscreen_ctx;_.beginPath(),_.moveTo(t[0],t[1]),_.lineTo(e[0],e[1]),_.lineTo(o[0],o[1]),_.fillStyle=r,_.fill(),_.lineWidth=n,_.strokeStyle=i,_.stroke()},t.prototype.draw_triangle=function(t,e,o,n,r,i){var _=this._offscreen_ctx,s=o/2;_.beginPath(),_.moveTo(t-s,e+s),_.lineTo(t+s,e+s),_.lineTo(t,e-s),_.fillStyle=r,_.fill(),_.lineWidth=n,_.strokeStyle=i,_.stroke()},t}();e.Render_screen=r},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this._renderer=t,this._nodes=[],this._num_nodes=0,this._thickness=.5,this._line_color="#222222",this._stroke_color=null}return t.prototype.add_node=function(t){this._nodes[this._num_nodes++]=t},t.prototype.set_line_color=function(t){this._line_color=t},t.prototype.set_stroke_color=function(t){this._stroke_color},t.prototype.set_thickness=function(t){this._thickness=t},t.prototype.draw=function(){if(!(this._num_nodes<2)){var t=this._nodes[0].x(),e=this._nodes[0].y(),o=this._nodes[1].x(),n=this._nodes[1].y();"square"==this._nodes[0].shape()&&(t+=this._nodes[0].width()/2,e+=this._nodes[0].height()/2),"square"==this._nodes[1].shape()&&(o+=this._nodes[1].width()/2,n+=this._nodes[1].height()/2),this._renderer.draw_line(t,e,o,n,this._thickness,this._line_color)}},t}();e.GUI_line_2_node=n;var r=o(1),i=o(0),_=o(0),s=o(0),h=function(){function t(t,e,o,n){this._radius=8,this._id=e,this._center_rect={x:0,y:0,w:16,h:16},this._topleft_rect={x:0,y:0,w:16,h:16},this._renderer=t,this._selected=!1,this._icon=null,this._border_color="#dedede",this._border_thickness=1,this._background_color="#000000",this._icon_color="#000000",this._caption_color="#ffffff",this._shape=n,this._caption="",this._text_autohide=!1,this._got_focus=!1,this._draggable=!1,this._icon_scale=1,this._font_size=14,this._font="Bitstream2",this._icon_x_offset=0,this._icon_y_offset=0,this._hit_test=!0,this._on_click=null,this._mx=0,this._my=0,this._indicator_color=null,this._highlighted=!1,this._highlightable=!0,this._static_color=!1,this._shaded_color=null,this._id=e,this._quad_ids=[],this._highlight_color="#44aa44",this._points=[],this._abs_points=[],this._prev_points=[],this._anchor_point=o,this._visible=!0,this._prev_state={x:0,y:0,w:16,h:16},this._br={x:0,y:0,w:0,h:0},this._state_changes=[],this._icon_style=-1,this._zoom_thresholds=[],this._zoom_thresholds.push(-1),this._zoom_thresholds.push(-1)}return t.prototype.set_visible=function(t){this._visible=t},t.prototype.visible=function(){return this._visible},t.prototype.anchor_point=function(){return this._anchor_point},t.prototype.set_anchor_point=function(t){this._anchor_point=t},t.prototype.set_quad_ids=function(t){this._quad_ids=t},t.prototype.set_prev_state=function(t,e,o,n){this._prev_state.x=t,this._prev_state.y=e,this._prev_state.w=o,this._prev_state.h=n},t.prototype.zoom_thresholds=function(){return this._zoom_thresholds},t.prototype.set_min_zoom=function(t){this._zoom_thresholds[0]=t},t.prototype.set_max_zoom=function(t){this._zoom_thresholds[1]=t},t.prototype.set_prev_point_state=function(t){this._prev_points=JSON.parse(JSON.stringify(t))},t.prototype.prev_point_state=function(){return this._prev_points},t.prototype.prev_state=function(){return this._prev_state},t.prototype.recalculate=function(){"polygon"==this._shape&&this.create_abs_points()},t.prototype.abs_points=function(){return JSON.parse(JSON.stringify(this._abs_points))},t.prototype.br=function(){return this._br},t.prototype.set_br=function(t){this._br=t},t.prototype.quad_ids=function(){return this._quad_ids},t.prototype.set_rect=function(t){this._anchor_point==i.Anchor.ANCHOR_CENTER?(this._center_rect=t,this._topleft_rect=r.FDGMath.rect_center_to_topleft(this._center_rect)):(this._topleft_rect=t,this._center_rect=r.FDGMath.rect_topleft_to_center(this._topleft_rect))},t.prototype.rect=function(){return this.internal_get_rect()},t.prototype.rect_with_border=function(){var t=this.internal_get_rect();return{x:t.x-this._border_thickness,y:t.y-this._border_thickness,w:t.w+this._border_thickness,h:t.h+this._border_thickness}},t.prototype.ap_border_rect=function(t){var e=null;return e=t==i.Anchor.ANCHOR_CENTER?this._center_rect:this._topleft_rect,{x:e.x-this._border_thickness,y:e.y-this._border_thickness,w:e.w+2*this._border_thickness,h:e.h+2*this._border_thickness}},t.prototype.id=function(){return this._id},t.prototype.set_static_color=function(t){this._static_color=t},t.prototype.static_color=function(){return this._static_color},t.prototype.print=function(){console.log("GUI_node: "+this._caption),console.log("        : center rect: "+JSON.stringify(this._center_rect)),console.log("        : ap_border_rect (center): "+JSON.stringify(this.ap_border_rect(i.Anchor.ANCHOR_CENTER))),console.log("        : topleft rect: "+JSON.stringify(this._topleft_rect)),console.log("        : ap_border_rect (top left): "+JSON.stringify(this.ap_border_rect(i.Anchor.ANCHOR_TOPLEFT))),console.log("        : contained in : "+JSON.stringify(this._quad_ids)),console.log("        : helper rect : "+JSON.stringify(this._prev_state)),"polygon"==this._shape&&console.log("        : BR : "+JSON.stringify(this._br))},t.prototype.font=function(){return this._font},t.prototype.font_size=function(){return this._font_size},t.prototype.icon_offset=function(){return{x:this._icon_x_offset,y:this._icon_y_offset}},t.prototype.internal_get_rect=function(){return this._anchor_point==i.Anchor.ANCHOR_CENTER?this._center_rect:this._topleft_rect},t.prototype.topleft_rect=function(){return this._topleft_rect},t.prototype.center_rect=function(){return this._center_rect},t.prototype.x=function(){return this.internal_get_rect().x},t.prototype.y=function(){return this.internal_get_rect().y},t.prototype.pos=function(){return{x:this.x(),y:this.y()}},t.prototype.autohidden_caption=function(){return this._text_autohide},t.prototype.selected=function(){return this._selected},t.prototype.caption_color=function(){return this._caption_color},t.prototype.caption=function(){return this._caption},t.prototype.width=function(){return this.internal_get_rect().w},t.prototype.height=function(){return this.internal_get_rect().h},t.prototype.radius=function(){return this._radius},t.prototype.icon=function(){return this._icon},t.prototype.is_box=function(){return!1},t.prototype.has_hit_test=function(){return this._hit_test},t.prototype.shape=function(){return this._shape},t.prototype.draggable=function(){return this._draggable},t.prototype.set_mousepos=function(t,e){this._mx=t,this._my=e},t.prototype.indicator_color=function(){return this._indicator_color},t.prototype.set_font=function(t){this._font=t},t.prototype.on_click=function(t){this._on_click=t},t.prototype.fetch_gui_children=function(t){},t.prototype.set_indicator_color=function(t){this._indicator_color=t},t.prototype.set_draggable=function(t){this._draggable=t},t.prototype.set_hit_test=function(t){this._hit_test=t},t.prototype.set_points=function(t){this._points=t,this.create_abs_points()},t.prototype.points=function(){return this._points},t.prototype.create_abs_points=function(){var t=this._center_rect;this._abs_points=[];for(var e=0;e<this._points.length;++e)this._abs_points.push({x:t.x+this._points[e].x,y:t.y+this._points[e].y});this.set_br(r.FDGMath.calc_br(this._abs_points))},t.prototype.set_icon_offset=function(t,e){this._icon_x_offset=t,this._icon_y_offset=e},t.prototype.set_font_size=function(t){this._font_size=t},t.prototype.set_caption_color=function(t){this._caption_color=t},t.prototype.set_autohidden_caption=function(t){this._text_autohide=t},t.prototype.set_icon_scale=function(t){this._icon_scale=t},t.prototype.set_icon=function(t,e){this._icon_style=e,this._icon=t,this.calc_icon_rect(),this._state_changes.push(_.State.STATE_ICON_ADDED)},t.prototype.icon_rect=function(){return this._icon_rect},t.prototype.calc_icon_rect=function(){var t=this._topleft_rect;this._icon_style!=s.IconStyle.ICON_STYLE_NORMAL?this._icon_rect=t:this._icon_rect={x:t.x,y:t.y,w:this._icon.rect().w,h:this._icon.rect().h}},t.prototype.set_icon_color=function(t){this._icon_color=t},t.prototype.set_background_color=function(t){this._background_color=t,this._shaded_color=t},t.prototype.background_color=function(){return this._background_color},t.prototype.set_border_color=function(t){this._border_color=t,this._state_changes.push(_.State.STATE_COLOR_CHANGE)},t.prototype.set_border_thickness=function(t){this._border_thickness=t},t.prototype.set_pos=function(t,e,o){void 0===o&&(o=!1);var n=this.internal_get_rect();n.x=t,n.y=e,this.set_rect(n),o&&this.recalculate()},t.prototype.state=function(){return this._state_changes.length<=0?_.State.STATE_NO_CHANGE:this._state_changes[0]},t.prototype.bring_to_back=function(){this._state_changes.push(_.State.STATE_CHANGE_TO_BACK)},t.prototype.bring_to_front=function(){this._state_changes.push(_.State.STATE_CHANGE_TO_FRONT)},t.prototype.pop_state=function(){this._state_changes.splice(0,1)},t.prototype.clear_states=function(){this._state_changes=[]},t.prototype.set_radius=function(t){var e=this.internal_get_rect();e.w=2*t,e.h=2*t,this._radius=t,this.set_rect(e)},t.prototype.set_height=function(t){var e=this.internal_get_rect();e.h=t,this.set_rect(e)},t.prototype.set_width=function(t){var e=this.internal_get_rect();e.w=t,this.set_rect(e)},t.prototype.set_caption=function(t){this._caption=t},t.prototype.calculate_width_from_caption=function(t){var e=this.internal_get_rect();e.w=this._renderer.calc_text_width(this._caption)+2*t,this.set_rect(e)},t.prototype.calc_nodes_pos=function(){},t.prototype.set_selected=function(t){this._selected=t,this._shaded_color=this.shaded_color()},t.prototype.shaded_color=function(){return this._selected?this._renderer.calc_shade_color(this._background_color,.5):this._background_color},t.prototype.text_rect=function(){if(this._selected&&this._text_autohide)return{x:this._mx,y:this._my,w:0,h:0};if(!this._text_autohide){var t=this.internal_get_rect(),e=this._renderer.calc_text_width(this._caption);return{x:t.x-e/2,y:t.y,w:0,h:0}}return null},t.prototype.set_highlightable=function(t){this._highlightable=t},t.prototype.highlightable=function(){return this._highlightable},t.prototype.set_highlighted=function(t){this._highlightable&&(this._highlighted=t)},t.prototype.highlighted=function(){return this._highlighted},t.prototype.draw=function(t){},t.prototype.hit_test=function(t,e){if(!this._hit_test)return null;var o=null,n=!1;return"circle"==this._shape?n=(t-(o=this._center_rect).x)*(t-o.x)+(e-o.y)*(e-o.y)<this._radius*this._radius:"polygon"==this._shape?n=r.FDGMath.p_poly(this._abs_points,t,e):"square"==this._shape?n=!((o=this._topleft_rect).x>t)&&(!(o.x+o.w<t)&&(!(o.y+o.h<e)&&!(o.y>e))):"triangle"==this._shape&&(o=this._topleft_rect,n=r.FDGMath.point_in_triangle(t,e,o.x-o.w/2,o.y+o.h/2,o.x+o.w/2,o.y+o.h/2,o.x,o.y-o.h/2)),n?this:null},t}();e.GUI_node=h},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o(1),r=o(0),i=o(0),_=function(){function t(t,e,o){this._renderer=t,this._changed=!0,this._rect=e,this._img_rect={x:0,y:0,w:0,h:0},this._pp_rect={x:this._rect.x-.5,y:this._rect.y-.5,w:this._rect.w+.5,h:this._rect.w+.5},this._layers={},this._bg_color="#000000",this._id=o,this._bg_image=null}return t.prototype.id=function(){return this._id},t.prototype.rect=function(){return this._rect},t.prototype.is_changed=function(){return this._changed},t.prototype.get_node_with_id=function(t,e){return void 0===e&&(e="default"),this._layers.hasOwnProperty(e)&&t in this._layers[e]?this._layers[e][t]:null},t.prototype.calc_node_inside=function(t){var e=null;return e="polygon"==t.shape()?t.br():t.ap_border_rect(r.Anchor.ANCHOR_TOPLEFT),n.FDGMath.a_rect_contains_b(this._pp_rect,e)?i.NodeOverlaps.NODE_FULLY_INSIDE:n.FDGMath.a_rect_overlaps_b(this._pp_rect,e)?i.NodeOverlaps.NODE_PARTIALLY_INSIDE:i.NodeOverlaps.NODE_NOT_INSIDE},t.prototype.clear_nodes=function(t){void 0===t&&(t="default"),this._layers.hasOwnProperty(t)||(this._layers[t]={})},t.prototype.add_node=function(t,e){void 0===e&&(e="default"),this._layers.hasOwnProperty(e)||(this._layers[e]={}),this.set_changed(!0),this._layers[e][t.id()]=t},t.prototype.nodes=function(t){return void 0===t&&(t="default"),this._layers[t]},t.prototype.set_changed=function(t){this._changed=t},t.prototype.set_bg_color=function(t){this._bg_color=t},t.prototype.get_nodes_at_pos=function(t,e,o){void 0===o&&(o="default");var n={};for(var r in this._layers[o]){var i=this._layers[o][r].hit_test(t,e);null!=i&&(n[r]=i)}return n},t.prototype.set_bg_image=function(t,e){this._bg_image=t,this._img_rect=e},t.prototype.draw=function(t,e,o){if(void 0===t&&(t="default"),void 0===e&&(e=!0),void 0===o&&(o=!1),!o&&!this.is_changed())return o;this._renderer.pre_draw(),this.set_changed(!1),null!=this._bg_image||this._renderer.draw_box(this._rect.x,this._rect.y,this._rect.w,this._rect.h,this._bg_color,this._bg_color,0);for(var n in this._layers[t])this._layers[t][n].draw(!1);return this._renderer.post_draw(),this._renderer.swap_buffer(this._rect),o},t.prototype.print=function(){console.log("GUI_quad: "+this.id()),console.log("        : pp rect: "+JSON.stringify(this._pp_rect))},t}();e.GUI_quad=_},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this._image=t,this._name=e,this._icons={}}return t.prototype.atlas_to_color=function(e,o){var n=document.createElement("canvas").getContext("2d");n.drawImage(this._image,0,0);var r=document.createElement("canvas"),i=r.getContext("2d");i.createImageData(1,1);i.beginPath(),i.rect(0,0,this._image.width,this._image.height),i.fillStyle="black",i.fill(),i.fillStyle=e;for(var _=0;_<this._image.height;++_)for(var s=0;s<this._image.width;++s){n.getImageData(s,_,1,1).data[0]>200&&i.fillRect(s,_,1,1)}return new t(r,o)},t.prototype.define_icon=function(t,e){this._icons[t]={rect:e,image:this._image}},t.prototype.get=function(t){return this._icons[t]},t}();e.GUI_atlas=n;var r=function(){function t(t,e){}return t.prototype.id=function(){return this._elem_id},t.prototype.name=function(){return this._name},t.prototype.img=function(){return this._img},t.prototype.rect=function(){return this._rect},t}();e.GUI_icon=r},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=0,r=o(0),i=function(){function t(t,e,o,n,r){void 0===n&&(n=0),void 0===r&&(r="#000"),this._id=t,this._type=e,this._color=o,this._border_thickness=n,this._border_color=r,this._nodes={}}return t.prototype.id=function(){return this._id},t.prototype.type=function(){return this._type},t.prototype.color=function(){return this._color},t.prototype.border_thickness=function(){return this._border_thickness},t.prototype.border_color=function(){return this._border_color},t.prototype.pop_node=function(t){if(!(t.id()in this._nodes))return null;var e=this._nodes[t.id()];return delete this._nodes[t.id()],e},t.prototype.add_node=function(t){this._nodes[t.id()]=t},t.prototype.remove_node=function(t){t.id()in this._nodes&&delete this._nodes[t.id()]},t.prototype.draw=function(t){this._type==r.RenderType.RT_SQUARE?t.draw_no_border_box_assoc(this._color,this._nodes):this._type==r.RenderType.RT_BORDER_SQUARE?t.draw_borders_assoc(this._border_color,this._border_thickness,this._nodes):this._type==r.RenderType.RT_POLYGON?t.draw_no_border_poly_assoc(this._color,this._nodes):this._type==r.RenderType.RT_BORDER_POLY?t.draw_borders_poly_assoc(this._border_color,this._border_thickness,this._nodes):this._type==r.RenderType.RT_TEXT?t.draw_text_assoc(this._color,this._nodes):this._type==r.RenderType.RT_ICON&&t.draw_icon_assoc(this._color,this._nodes)},t.prototype.print=function(){var t=[];for(var e in this._nodes){var o=this._nodes[e];t.push({id:o.id(),t:o.shape()})}console.log(JSON.stringify(t))},t}();e.Render_type=i;var _=function(){function t(t){this._render_types=[];for(var e=0;e<6;++e)this._render_types[e]={};this._renderer=t}return t.prototype.add_icon=function(){for(var t in this._render_types[5]){if((e=this._render_types[5][t]).type()==r.RenderType.RT_ICON)return e}var e=new i(n++,r.RenderType.RT_ICON,null,null,null);return this._render_types[5][e.id()]=e,e},t.prototype.add_square=function(t,e){void 0===e&&(e=0);for(var o in this._render_types[e+0]){if((_=this._render_types[e+0][o]).type()==r.RenderType.RT_SQUARE&&_.color()==t)return _}var _=new i(n++,r.RenderType.RT_SQUARE,t,null,null);return this._render_types[e+0][_.id()]=_,_},t.prototype.add_polygon=function(t,e){void 0===e&&(e=0);for(var o in this._render_types[e+0]){if((_=this._render_types[e+0][o]).type()==r.RenderType.RT_POLYGON&&_.color()==t)return _}var _=new i(n++,r.RenderType.RT_POLYGON,t,null,null);return this._render_types[e+0][_.id()]=_,_},t.prototype.add_border=function(t,e){for(var o in this._render_types[1]){if((_=this._render_types[1][o]).type()==r.RenderType.RT_BORDER_SQUARE&&_.border_thickness()==t&&_.border_color()==e)return _}var _=new i(n++,r.RenderType.RT_BORDER_SQUARE,null,t,e);return this._render_types[1][_.id()]=_,_},t.prototype.add_text=function(t){for(var e in this._render_types[4]){if((o=this._render_types[4][e]).type()==r.RenderType.RT_TEXT&&o.color()==t)return o}console.log("added text");var o=new i(n++,r.RenderType.RT_TEXT,t);return this._render_types[4][o.id()]=o,o},t.prototype.add_border_poly=function(t,e){for(var o in this._render_types[1]){if((_=this._render_types[1][o]).type()==r.RenderType.RT_BORDER_POLY&&_.border_thickness()==t&&_.border_color()==e)return _}var _=new i(n++,r.RenderType.RT_BORDER_POLY,null,t,e);return this._render_types[1][_.id()]=_,_},t.prototype.remove_node=function(t,e){var o=[];e==r.RenderType.RT_BORDER_POLY||e==r.RenderType.RT_BORDER_SQUARE?(o.push(1,3),console.log("removing border")):e==r.RenderType.RT_SQUARE||e==r.RenderType.RT_POLYGON?o.push(0,2):e==r.RenderType.RT_TEXT&&o.push(4);for(var n=0;n<o.length;++n)for(var i in this._render_types[o[n]])this._render_types[o[n]][i].remove_node(t)},t.prototype.push_back=function(t){for(var e=0;e<this._render_types.length;++e)for(var o in this._render_types[e]){var n=this._render_types[e][o].pop_node(n);null!=n&&(0==e||1==e?console.error("Node is already the furthest back possible"):this._render_types[e-2][o].add_node(n))}},t.prototype.push_to_front=function(t){if(this.remove_node_from_all(t),"square"==t.shape()){this.add_square(t.background_color()).add_node(t)}else if("polygon"==t.shape()){this.add_polygon(t.background_color()).add_node(t)}},t.prototype.remove_node_from_all=function(t){for(var e=0;e<this._render_types.length;++e)for(var o in this._render_types[e])this._render_types[e][o].remove_node(t)},t.prototype.get=function(t){return t in this._render_types?this._render_types[t]:null},t.prototype.draw=function(){for(var t=0;t<this._render_types.length;++t)for(var e in this._render_types[t])this._render_types[t][e].draw(this._renderer)},t.prototype.print=function(){for(var t=0;t<this._render_types.length;++t){var e=this._render_types[t];for(var o in e)console.log("RenderType index "+t+" with rt key k: "+o),e[o].print()}},t}();e.Render_type_handler=_}]);